<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±—é–¥–∂–µ—Ç–æ–º</title>
    <style>
        body { font-family: sans-serif; background-color: #f4f4f9; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .panel { background-color: white; padding: 40px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center; }
        h1 { color: #333; }
        button { background-color: #4CAF50; color: white; padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 10px; transition: background-color 0.3s; }
        button:hover { background-color: #45a049; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        #status { margin-top: 20px; font-style: italic; color: #555; white-space: pre-wrap; text-align: left; }
    </style>
</head>
<body>

    <div class="panel">
        <h1>üöÄ –ú–æ–π –ë—é–¥–∂–µ—Ç</h1>
        <button id="transactionsBtn" onclick="runFunction('transactions')">–û–±–Ω–æ–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</button>
        <button id="balancesBtn" onclick="runFunction('balances')">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å—ã</button>
        <pre id="status"></pre>
    </div>

    <script src="config.js"></script>
    <script>
        const transactionsBtn = document.getElementById('transactionsBtn');
        const balancesBtn = document.getElementById('balancesBtn');
        const statusDiv = document.getElementById('status');

        async function runFunction(action) {
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥–≤–æ–π–Ω–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è
            transactionsBtn.disabled = true;
            balancesBtn.disabled = true;

            let url = CLOUD_FUNCTION_URL + `?action=${action}`;

            if (action === 'transactions') {
                const days = prompt("–ó–∞ —Å–∫–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–Ω–µ–π –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏?", "30");
                if (days === null) { // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–û—Ç–º–µ–Ω–∞"
                    statusDiv.textContent = "–û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞.";
                    transactionsBtn.disabled = false;
                    balancesBtn.disabled = false;
                    return;
                }
                url += `&days=${days}`;
                statusDiv.textContent = '–ó–∞–ø—É—Å–∫–∞—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç...';
            } else {
                statusDiv.textContent = '–ó–∞–ø—Ä–∞—à–∏–≤–∞—é –±–∞–ª–∞–Ω—Å—ã...';
            }

            try {
                const response = await fetch(url);
                const resultText = await response.text();

                if (response.ok) {
                    if (action === 'balances') {
                        statusDiv.textContent = '–ë–∞–ª–∞–Ω—Å—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã:\n\n' + resultText;
                    } else {
                        statusDiv.textContent = '–ì–æ—Ç–æ–≤–æ! –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —É—Å–ø–µ—à–Ω–æ –≤—ã–≥—Ä—É–∂–µ–Ω—ã –≤ Google –¢–∞–±–ª–∏—Ü—É.';
                    }
                } else {
                    statusDiv.textContent = `–û—à–∏–±–∫–∞! –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª: ${response.status}\n${resultText}`;
                }
            } catch (error) {
                statusDiv.textContent = '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≤—è–∑–∞—Ç—å—Å—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º.';
                console.error('Fetch error:', error);
            }

            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
            transactionsBtn.disabled = false;
            balancesBtn.disabled = false;
        }
    </script>

</body>
</html>
